<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ุจูุชูููู ูุงุด - ุฅุซุจุงุช ุงูุฏูุน</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>๐ค ุฅุซุจุงุช ุงูุฏูุน / ุดุญู ุงูุฑุตูุฏ</h1>
    <p>ุจุนุฏ ุชุญููู ุงููุจูุบ ุฅูู ูุญูุธุชูุงุ ูู ุจุฑูุน ุตูุฑุฉ ุงูุชุญููู ููุชู ุชุฃููุฏ ุงูุดุญู.</p>
  </header>

  <main>
    <section class="card">
      <h2>ุจูุงูุงุช ุงูุนูููุฉ</h2>
      <p id="amount-info"></p>
      <p class="hint">ุนููุงู ูุญูุธุชูุง (BTC): <strong>ุถุน_ุงูุนููุงู_ููุง</strong></p>

      <label>ุฑุงุจุท ุตูุฑุฉ ุฅุซุจุงุช ุงูุชุญููู (ูุซูุงู ูู ุชููุบุฑุงูุ ุฌูุฌู ุฏุฑุงููุ ...)</label>
      <input type="url" id="image-url" placeholder="https://..." />

      <label>ููุงุญุธุฉ (ุงุฎุชูุงุฑู)</label>
      <textarea id="note" rows="3" placeholder="ุฃู ุชูุงุตูู ุฅุถุงููุฉ"></textarea>

      <button id="send-proof" class="primary">ุฅุฑุณุงู ุงูุฅุซุจุงุช</button>
      <p id="proof-status" class="status"></p>
    </section>
  </main>

  <nav class="bottom-nav">
    <a href="profile.html">๐ค ุงูููู ุงูุดุฎุตู</a>
    <a href="ads.html">๐บ ุงูุฅุนูุงูุงุช</a>
    <a href="wallet.html">๐ผ ูุญูุธุชู</a>
    <a href="about.html">โน๏ธ ูู ูุญู</a>
  </nav>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="supabase.js"></script>
  <script>
    const amountInfo = document.getElementById('amount-info');
    const imageUrlInput = document.getElementById('image-url');
    const noteInput = document.getElementById('note');
    const statusEl = document.getElementById('proof-status');

    function getAmountFromUrl() {
      const params = new URLSearchParams(window.location.search);
      const amount = params.get('amount');
      return amount ? Number(amount) : null;
    }

    async function initPage() {
      const amount = getAmountFromUrl();
      if (amount) {
        amountInfo.textContent = 'ุงููุจูุบ ุงููุทููุจ ุดุญูู: $' + amount;
      } else {
        amountInfo.textContent = 'ุงููุจูุบ ุบูุฑ ูุญุฏุฏ ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ.';
      }
    }

    document.getElementById('send-proof').addEventListener('click', async () => {
      statusEl.textContent = 'ุฌุงุฑู ุงูุฅุฑุณุงู...';

      const user = await getCurrentUser();
      if (!user) {
        statusEl.textContent = 'ุงูุฑุฌุงุก ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ.';
        return;
      }

      const amount = getAmountFromUrl() || 0;
      const imageUrl = imageUrlInput.value.trim();
      const note = noteInput.value.trim();

      const { data, error } = await supabase.from('payments').insert({
        user_id: user.id,
        amount,
        image_url: imageUrl,
        note,
      });

      if (error) {
        statusEl.textContent = 'ุฎุทุฃ: ' + error.message;
      } else {
        statusEl.textContent = 'ุชู ุฅุฑุณุงู ุฅุซุจุงุช ุงูุฏูุน โ ุณูุชู ูุฑุงุฌุนุฉ ุงูุทูุจ ูุฏููุงู.';
        imageUrlInput.value = '';
        noteInput.value = '';
      }
    });

    initPage();
  </script>
</body>
</html>
